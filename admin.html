<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
  body {background:#121212;color:white;font-family:Arial;}
  h2 {text-align:center;margin-top:20px;}
  table {margin:20px auto;border-collapse:collapse;width:95%;}
  th,td{border:1px solid #555;padding:6px;text-align:center;}
  th{background:#333;}
  input{width:90%;background:#1c1c1c;color:white;border:none;padding:4px;}
  button{margin:5px;padding:6px 12px;border:none;border-radius:4px;background:#6A5ACD;color:white;cursor:pointer;}
  .del{background:#b33;}
  .add{background:#3a7;}
</style>
</head>
<body>
  <h2>⚙ Панель администратора</h2>
  <table id="table"><thead>
    <tr>
      <th>Login</th><th>Password</th><th>Username</th>
      <th>Mem</th><th>Sub (подписка)</th><th>can_download</th><th>ID</th><th>Удалить</th>
    </tr>
  </thead><tbody></tbody></table>

  <div style="text-align:center;">
    <input id="newLogin" placeholder="Login">
    <input id="newPass" placeholder="Password">
    <input id="newUser" placeholder="Username">
    <button class="add" onclick="addUser()">➕ Добавить</button>
    <button onclick="goOut()">⬅ Выйти</button>
  </div>

<script>
let users = JSON.parse(localStorage.getItem("users")) || [
  {login:"admin",password:"1234",username:"Administrator",mem:"16384Mb",sub:"-",ident:"1",can_download:true},
  {login:"user",password:"pass",username:"TestUser",mem:"4096Mb",sub:"-",ident:"2",can_download:false}
];

// Функция отрисовки таблицы
function renderUsers(){
  const tbody=document.querySelector("#table tbody");
  tbody.innerHTML="";
  users.forEach((u,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td><input value="${u.login}" onchange="edit(${i},'login',this.value)"></td>
      <td><input value="${u.password}" onchange="edit(${i},'password',this.value)"></td>
      <td><input value="${u.username}" onchange="edit(${i},'username',this.value)"></td>
      <td><input value="${u.mem}" onchange="edit(${i},'mem',this.value)"></td>
      <td>
        <span id="sub_${i}">${u.sub}</span><br>
        <button onclick="giveSub(${i})">Выдать 900 лет</button>
      </td>
      <td>
        <input type="checkbox" ${u.can_download?"checked":""} onchange="toggleDownload(${i},this.checked)">
      </td>
      <td>${u.ident}</td>
      <td><button class="del" onclick="delUser(${i})">❌</button></td>
    `;
    tbody.appendChild(tr);
  });
  localStorage.setItem("users", JSON.stringify(users));
}

// Редактирование простых полей
function edit(i,key,value){ users[i][key]=value; localStorage.setItem("users",JSON.stringify(users)); }

// Выдача подписки на 900 лет
function giveSub(i){
  let today=new Date();
  today.setFullYear(today.getFullYear()+900);
  let d=today.toISOString().split("T")[0]; // формат YYYY-MM-DD
  users[i].sub=d;
  document.getElementById("sub_"+i).innerText=d;
  localStorage.setItem("users",JSON.stringify(users));
}

// Переключение can_download
function toggleDownload(i,val){
  users[i].can_download=val;
  localStorage.setItem("users", JSON.stringify(users));
}

// Удалить пользователя
function delUser(i){ users.splice(i,1); localStorage.setItem("users",JSON.stringify(users)); renderUsers(); }

// Добавить нового
function addUser(){
  let id=users.length+1;
  users.push({
    login:document.getElementById("newLogin").value||"newuser"+id,
    password:document.getElementById("newPass").value||"1234",
    username:document.getElementById("newUser").value||"User"+id,
    mem:"1024Mb",
    sub:"-",
    ident:String(id),
    can_download:false
  });
  localStorage.setItem("users",JSON.stringify(users));
  renderUsers();
}

// Выйти
function goOut(){ window.location="index.html"; }

// Запуск
renderUsers();
</script>
</body>
</html>
